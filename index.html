<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mdrn Quest</title>
    <style>
        @font-face { 
            font-family: 'Medieval'; 
            src: url('./blackletter.TTF') format('truetype'); 
        }

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #000; 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none; 
            font-family: 'Helvetica',Helvetica, sans-serif;
        }

        canvas { display: block; }

        /* --- MAIN MENU SCREEN --- */
        #main-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 10000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center;
            overflow-y: auto; /* Allow scrolling on small landscape screens */
        }

        .menu-logo {
            max-width: 80%;
            max-height: 30vh; /* CRITICAL FIX: Stops logo taking full screen */
            width: auto;
            height: auto;
            margin-bottom: 20px;
            object-fit: contain;
            filter: drop-shadow(0 0 10px #ffff00);
        }

        #menu-start {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Space between buttons */
            width: 100%;
            align-items: center;
        }

        .menu-btn {
            background: rgba(0,0,0,0.5);
            border: 2px solid #fff;
            color: #fff;
            font-family: 'Medieval', serif;
            font-size: 28px;
            padding: 12px 30px;
            cursor: pointer;
            width: 260px;
            transition: all 0.2s;
        }

        .menu-btn:active { background: #fff; color: #000; transform: scale(0.95); }
        .menu-btn:hover { border-color: #ffff00; color: #ffff00; text-shadow: 0 0 10px #ffff00; }

        /* MAP SELECTION SUB-MENU */
        #map-selection {
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 10px;
        }

        .map-btn {
            border-color: #00ff00;
            color: #00ff00;
        }

        /* --- HUD (Hidden until playing) --- */
        #ui-container {
            display: none; /* Hidden on load */
            position: absolute; top: 20px; left: 20px;
            color: white; pointer-events: none;
            text-shadow: 2px 2px 0px #000; z-index: 100;
        }

        p.score-text { font-family: 'Medieval', serif; font-size: 30px; margin: 0; }
        .highlight { color: #ffff00; }
        .danger { color: #ff3333; }

        #pause-screen {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-family: 'Medieval', serif;
            font-size: 80px; color: white; text-shadow: 5px 5px 0px #000;
            z-index: 200; text-align: center;
        }

        #game-over {
            display: none; font-family: 'Medieval', serif; font-size: 60px; 
            color: #ff3333; margin-top: 20px; text-shadow: 4px 4px 0px #000;
        }

        #zone-warning {
            display: none; position: absolute; top: 20%; width: 100%;
            text-align: center; font-family: 'Helvetica', sans-serif;
            font-size: 24px; font-weight: bold; color: #ff0000;
            text-shadow: 0 0 10px #ff0000; letter-spacing: 4px;
            z-index: 150; animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.5; } 50% { opacity: 1.0; transform: scale(1.1); } 100% { opacity: 0.5; }
        }

        /* --- CONTROLS --- */
        #mobile-controls { display: none; } /* Hidden on load */
        
        #zone_joystick { position: absolute; bottom: 40px; left: 40px; width: 150px; height: 150px; z-index: 150; }
        
        #mobile-jump {
            position: absolute; bottom: 40px; right: 40px; width: 90px; height: 90px;
            background: rgba(50, 205, 50, 0.3); border: 4px solid #32CD32;
            border-radius: 50%; display: flex; justify-content: center;
            align-items: center; color: white; font-family: 'Helvetica', sans-serif;
            font-weight: bold; font-size: 18px; z-index: 150;
            text-shadow: 1px 1px 0 #000; user-select: none;
        }
        #mobile-jump:active { background: rgba(50, 205, 50, 0.6); transform: scale(0.95); }

        .debug-btn {
            background: #333; color: white; border: 1px solid #555;
            padding: 8px 12px; margin-bottom: 5px; cursor: pointer;
            font-family: sans-serif; font-size: 12px; display: block; width: 100%;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>
</head>
<body>
    
    <div id="main-menu">
        <img src="mdrnquest.png" alt="MDRN QUEST" class="menu-logo">
        
        <div id="menu-start">
            <button class="menu-btn" onclick="window.showMapSelection()">Play</button>
            <button class="menu-btn" onclick="window.showHighScores()">High Scores</button>
        </div>

        <div id="map-selection">
            <h2 style="color:white; font-family:'Medieval', serif; font-size:40px; margin:0 0 20px 0;">SELECT SECTOR</h2>
            <button class="menu-btn map-btn" onclick="window.selectMap('shoreditch.glb')">Shoreditch</button>
            <button class="menu-btn map-btn" onclick="window.selectMap('archway.glb')">Archway</button>
            <button class="menu-btn map-btn" onclick="window.selectMap('carnabyst.glb')">Carnaby St</button>
            <button class="menu-btn" style="border-color:#ff3333; color:#ff3333; margin-top:20px;" onclick="window.backToMenu()">BACK</button>
        </div>
    </div>

    <div id="ui-container">
        <p class="score-text"><span id="score" class="highlight">0</span></p>
        <p class="score-text" style="font-size: 20px; opacity: 0.8;">Time: <span id="timer">60.0</span>s</p>

        <div id="status-panel" style="margin-top: 10px; font-family: 'Helvetica', sans-serif; font-size: 16px; font-weight: bold;">
            <div id="status-bike" style="color: #32CD32; display: none; text-shadow: 2px 2px 0px #000;">
                [ LIME BIKE ]
            </div>
            <div id="status-drink" style="color: #00FFFF; display: none; text-shadow: 2px 2px 0px #000;">
                ENERGY: <span id="drink-timer">0.0</span>s
            </div>
        </div>
        
        <div id="game-over">SHIFT ENDED</div>
    </div>
    
    <div id="zone-warning">⚠️ LEAVING SAFE ZONE ⚠️</div>

    <div id="mobile-controls">
        <div id="zone_joystick"></div>
        <div id="mobile-jump">JUMP</div>
    </div>

   <div style="position: absolute; top: 10px; right: 10px; z-index: 90; display: flex; flex-direction: column; gap: 5px; width: 120px;">
        <button class="debug-btn" onclick="window.spawnPolice()">Spawn Police</button>
        <button class="debug-btn" onclick="window.debugSpawn('bike')" style="border-color: #32CD32; color: #32CD32;">Spawn Bike</button>
        <button class="debug-btn" onclick="window.debugSpawn('drink')" style="border-color: #00FFFF; color: #00FFFF;">Spawn Drink</button>
    </div>
    
    <div id="pause-screen">
        PAUSED<br>
        <span style="font-size: 20px; font-family: sans-serif; opacity: 0.7;">TAP P TO RESUME</span>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script type="module" src="./game.js"></script>
</body>
</html>